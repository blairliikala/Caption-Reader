var c=class{static timecodeToSeconds(t=""){if(!/^[0-9][0-9]/.test(t)||typeof t!="string")return;let e=t.split(":");if(!e||e.length===1)return t;let s=parseInt(e[0],10),r=parseInt(e[1],10),a=parseInt(e[2],10),l=t.split(".");return l.length===1&&(l=t.split(",")),s*3600+r*60+a+l[1]/1e3}static isValidJSON(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}static isTimecode(t){return/^[0-9][0-9]/.test(t)}static prettyTimecode(t){if(!/^[0-9][0-9]/.test(t)||typeof t!="string")return;let e=t.split(":");if(e.length===0)return[];e.length-1===2&&e[0]==="00"&&e.splice(0,1);let s=e[e.length-1];return s=s.replace(",","."),s=Math.round(s),s<10&&(s=`0${s}`),e[e.length-1]=s,e.join(":")}static secondsToTimecode(t=0){return typeof t!="number"?"":t<0?"00:00:00":new Date(t*1e3).toISOString().substring(11,11+8)}static getTheme(t){return t==="light"?"light":t==="dark"?"dark":matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}static getSupportedFileType(t){let i=t.split("."),e=i[i.length-1];return["vtt","srt"].find(r=>r===e)}};function C(n,t){let i=/<(\d\d:\d\d:\d\d\.\d\d\d)>/,e=n.split(i),s=[];for(let r=1;r<e.length;r+=1)r===1&&s.push({seconds:t,text:e[0],status:void 0}),s.push({seconds:c.timecodeToSeconds(e[r]),text:e[r+1],status:void 0}),r+=1;return s}function m(n){if(!n.cues)return;let t=Object.entries(n.cues).map(e=>{let s=e[1];return{chapter:s.id,status:"",text:s.text.split(`
`).map(r=>r.replace(/^\s+/g,"")),subCues:void 0,seconds:{start:s.startTime,end:s.endTime},timecode:{start:c.secondsToTimecode(s.startTime),end:c.secondsToTimecode(s.endTime)}}});return{kind:n.kind,lang:n.language,label:n.label,header:n.id,styles:void 0,cues:t}}function b(n){return n.map(t=>{let i=t.text[1]||"";return t.subCues=void 0,i.includes("<")&&(t.subCues=C(i,t.seconds.start)),t})}function v(n,t){if(!n||n.length===0)return;let i=!1,e=n[0];if(e.seconds.start>t){let s={chapter:"",text:[],type:"spacer",timecode:{start:c.secondsToTimecode(0),end:c.secondsToTimecode(e.seconds.start)},seconds:{start:0,end:e.seconds.start}};n.unshift(s)}return n.forEach((s,r)=>{let a=n[r+1];if(i){i=!1;return}if(!a)return;if(a.seconds.start-s.seconds.end>t){let u=s.seconds.end,o=a.seconds.start,h={chapter:"",text:[],type:"spacer",timecode:{start:c.secondsToTimecode(u),end:c.secondsToTimecode(u)},seconds:{start:u,end:o}};n.splice(r+1,0,h),i=!0}return[]}),n}function y(n){return n&&n.sort((t,i)=>t.seconds.start<i.seconds.start?-1:t.seconds.start>i.seconds.start?1:0)}function x(n){return n&&n.filter((i,e)=>{let s=JSON.stringify(i),r=n.findIndex(a=>JSON.stringify(a)===s);return e===r})}function T(n,t){let i=n.split(`
`),e={kind:t||i[0].startsWith("WEBVTT"),lang:void 0,header:void 0,styles:void 0,cues:[]},s={text:[]},r=0,a=!1,l="",u="";for(let o of i){if(o.startsWith("WEBVTT")){let h=o.split(" - ");h.length>0&&(e.header=h[1])}else if(o.startsWith("Kind")){let h=o.split(":");e.kind=h[1]?.trim()}else if(o.startsWith("Language")){let h=o.split(":");e.lang=h[1]?.trim()}else if(o.startsWith("STYLE"))a=!0,u="styles";else if(!o.startsWith("NOTE"))if(a===!0&&o!=="")l+=o;else if(a===!0&&o==="")e.styles=l,a=!1,l="";else if(o!==""&&c.isTimecode(i[r+1]))s.chapter=o;else if(c.isTimecode(o)){let h=o.split("-->"),p=h[1]?h[1]?.split(" "):void 0,f=p?p[1]?.trim():"";s.timecode={start:h[0].trim(),end:f},s.seconds={start:c.timecodeToSeconds(h[0]),end:c.timecodeToSeconds(f)},s.length=s.seconds.start+s.seconds.end;let g=o.split(" ");g.length>2&&(s.styles=g.splice(3).join(" "))}else o!==""&&(t==="srt"?s.text.push(o.replace(/(<([^>]+)>)/gi,"")):s.text.push(o));o===""&&s.timecode?.start!==void 0&&(a&&(a=!1,u=""),s.active=!1,e.cues.push(s),s={text:[]}),r+=1}return e}function S(){return`<style id="theme_a">
  #root {
    display: block;
    scroll-behavior: smooth;
    height: 300px;
    overflow-y: scroll;
    overflow-x: hidden;
    scroll-snap-stop: always;
    position: relative;
    padding: .5rem;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    --base: 360;

    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-50-opacity: 0.5;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 20%, 40%, 0.9);
    --inactive-90: hsla(var(--base), 20%, 40%, 0.5);
    --active-primary: hsla(var(--base), 0%, 30%, 1);
    --active-secondary: hsla(var(--base), 40%, 70%, 1);
    --highlight: hsla(var(--base), 50%, 50%, 0.9);
  }
  [data-theme="dark"]#root {
    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 10%, 80%, 0.7);
    --inactive-90: hsla(var(--base), 10%, 80%, 0.5);
    --active-primary: hsla(var(--base), 0%, 100%, 1);
    --active-secondary: hsla(var(--base), 20%, 80%, 1);
    --highlight: hsla(var(--base), 50%, 60%, 0.9);
  }
  #root * {
    box-sizing: border-box;
  }
  .empty {
    color: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-70-opacity));
  }
  ol {
    padding: 0;
    margin: 0;
  }
  li {
    list-style:none;
    width: 100%;
  }
  .cue {
    border: none;
    font: inherit;
    padding: 0.4rem 10% 0.4rem .4rem;
    display: flex;
    gap: 1rem;
    transform: scale(1);
    transform-origin: left;
    color: var(--inactive);
    transition: all .3s ease;
    background: none;
    width: 100%;
    text-align: start;
    border-left: 2px solid hsla(var(--base), 60%, 70%, 0.1);
    border-radius: 0;
    color: transparent;
    text-shadow: 0 0 2px var(--inactive-90);
    font-weight: bold;
  }
  .cue:focus {
    background: none;
    border: none;
    outline: none;
  }
  .cue:hover, .cue:active {
    cursor: pointer;
    color: var(--active-secondary);
    background: none;
    border-left-color: var(--highlight);
    outline: 1px solid var(--highlight);
    text-shadow: none;
  }
  @supports (-webkit-touch-callout: none) {
    .cue:hover {
      outline: none;
    }
  }
  .cue:focus-visible, .cue:focus {
    cursor: pointer;
    border-left-color: var(--highlight);
    outline: 1px solid var(--highlight);
    color: var(--secondary);
    background: none;
    text-shadow: none;
  }
  .cue:hover {
    background :none;
  }
  .upcoming {
    transform: scale(1);
    transform-origin: left;
  }
  .next {
    transform: scale(1);
    transform-origin: left;
    text-shadow: none;
    color: var(--inactive);
  }
  .active {
    transform: scale(1.05);
    transform-origin: left;
    border-color: var(--highlight);
    text-shadow: none;
    font-weight: bold;
    color: var(--active-secondary);
  }
  .active .timecode {
    color: var(--active-secondary);
  }
  .active .chapter {
    color: var(--active-secondary);
  }
  .active .text  {
    color: var(--active-primary);
  }
  .active .sub_active {
    text-decoration: underline;
  }
  .previous {
    color: var(--inactive);
  }
  .passed  {
    transform: scale(1);
    transform-origin: left;
  }
  .scrolling .cue {
    text-shadow: none;
    color: var(--inactive);
  }
  @media (prefers-reduced-motion) {
    .active {
      transform: scale(1);
    }
  }
  progress {
    appearance: none;
    background: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-10-opacity));
    border: none;
    border-radius: 2px;
    height: 8px;
    align-self: center;
  }
  progress[value]::-webkit-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-20-opacity));
    box-shadow: none;
  }
  progress[value]::-moz-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-50-opacity));
    box-shadow: none;
  }
  progress[value]::-webkit-progress-value {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-50-opacity));
    box-shadow: none;
  }
  </style>`}var d=class extends HTMLElement{#C=!1;#e;#l="";#s=0;#h="400px";#r=4e3;#y=!1;#g="";#u="";#d="";#p=!1;#f=!0;#t={};#n=void 0;#i=!1;#m=!1;#o={};#x=5;#a=.5;#T=!1;css=S();constructor(){super(),this.isConnected&&this.#k()}static get observedAttributes(){return["src","playhead","height","debounce","singleline","color","disable","spacer"]}attributeChangedCallback(t,i,e){if(t==="playhead"){this.#v(e);return}if(t==="debounce"){this.#r=e;return}this.#b({changes:{name:t,oldValue:i,newValue:e}})}set src(t){t?this.setAttribute("src",t):this.removeAttribute("src")}set playhead(t){this.setAttribute("playhead",t)}set debounce(t){t?this.setAttribute("debounce",t):this.removeAttribute("debounce")}set singleline(t){if(typeof t!="boolean"){console.warn("singleline must be a boolean.",t),this.#c("error","singleline must be a boolean.");return}this.setAttribute("singleline",t)}set disable(t){this.setAttribute("disable",t),t?this.setAttribute("disable",t):this.removeAttribute("disabled")}set debounceScrolling(t){if(typeof t!="boolean"){console.warn("debounceScrolling must be a boolean.",t),this.#c("error","debounceScrolling must be a boolean.");return}this.#i=t}set textTrack(t){this.#o=t,this.#b({changes:{name:"textTrack"}})}set spacer(t){this.#x=t}set youtube(t){if(typeof t!="boolean"){console.warn("youtube must be a boolean.",t),this.#c("error","youtube must be a boolean.");return}this.#p=t}set height(t){if(typeof t!="string"){console.warn("height must be a string with a unit value.",t),this.#c("error","height must be a string with a unit value.");return}this.setAttribute("height",t)}set nudge(t){this.#a=t}get src(){return this.#l}get playhead(){return this.#s}get captions(){return this.#t}get debounce(){return this.#r}get singleline(){return this.#y}get height(){return this.#h}get paused(){return this.#m}get disable(){return this.#u}get theme(){return this.#d}get spacer(){return this.#x}get textTrack(){return this.#o}get youtube(){return this.#p}get enableCSS(){return this.#f}get nudge(){return this.#a}connectedCallback(){this.#k()}disconnectedCallback(){}#k(){if(this.#C){this.#b();return}this.#C=!0;let t=document.createElement("template");t.innerHTML=`
      ${this.css}
      <captionselement id="root" data-theme=""></captionselement>
    `;let i=t.content.cloneNode(!0);this.appendChild(i),this.#e={root:this.querySelector("#root")},this.#e.root.addEventListener("click",e=>{let s=e.composedPath()[0].closest("button");if(s&&"localName"in s&&s.localName==="button"){let r=s.dataset.start;this.#c("seek",r),this.#v(r+.2)}}),this.#E(),this.#b()}async#b(t){if(this.#l=this.getAttribute("src")||this.#l,this.#s=parseInt(this.getAttribute("playhead"),10)||this.#s,this.#h=this.getAttribute("height")||this.#h,this.#r=parseInt(this.getAttribute("debounce"),10)||this.#r,this.#y=this.getAttribute("singleline")==="true"||this.getAttribute("singleline")===!0||!1,this.#g=this.getAttribute("color")||this.#g,this.#u=this.getAttribute("disable")||"",this.#d=this.getAttribute("theme")||this.#d,this.#p=this.getAttribute("youtube")==="true"||this.getAttribute("youtube")===!0||this.#p,this.#f=this.getAttribute("stylesheet")||this.#f,!this.#l&&!(this.#o&&"id"in this.#o)){console.debug("No text track");return}if(this.#f==="false"||this.#f===!1){let e=this.querySelector("#theme_a");e.innerHTML=""}this.setTheme();let i=[];if(this.#h!=="400px"&&i.push(`height: ${this.#h}`),this.#g&&i.push(`--base: ${this.#g}`),this.#e.root?.setAttribute("style",i.join("; ")),t?.changes.name==="src"||t?.changes.name==="textTrack"){if(this.#t=await this.#w(this.#o,this.#l),!this.#t||!this.#t.cues)return;this.#c("parsed","Caption file has been parsed."),this.#p&&(this.#t.cues=this.#q(this.#t.cues)),this.#S(),this.#v(this.#s+.9)}this.#e.root.innerHTML=this.#$(this.#t)}async#w(t,i){let e,s=t;if(i&&c.getSupportedFileType(i)==="vtt"&&(s=await this.#M(i)),s&&"cues"in s&&(e=m(s)),i&&(!e||!e.cues)){let r=await fetch(i).then(l=>l.text()),a=c.getSupportedFileType(i);r&&(e=T(r,a))}if(!e||!e.cues){console.error("Not able to find and render captions.",e),this.#e.root.innerHTML='<p class="empty">No captions.</p>';return}return e.cues=b(e.cues),e.cues=x(e.cues),e.cues=v(e.cues,this.#x),e.cues=y(e.cues),this.#o=s,e}#E(){let t=!1,i,e=()=>{this.#e.root.classList.add("scrolling")},s=()=>{this.#e.root.classList.remove("scrolling")};this.#e.root.addEventListener("touchstart",()=>{t=!0,this.#i=!0,clearTimeout(i),e()}),this.#e.root.addEventListener("touchend",()=>{t=!1,i=setTimeout(()=>{t=!1,this.#i=!1,s()},this.#r)}),setTimeout(()=>{this.#e.root.addEventListener("scroll",()=>{t||this.#T||(this.#i===!0&&clearTimeout(i),this.#i=!0,e(),i=setTimeout(()=>{this.#i=!1,s()},this.#r))},!1)},1e3)}#v(t){if(this.#m||(this.#s=t,!this.#t||!this.#t.cues))return;this.#S();let i=this.#t.cues?.findIndex(s=>s.status==="active");if(this.#t.cues?.forEach((s,r)=>{if(s.type==="spacer"&&s.status==="active"){let a=Math.round(this.#s-s.seconds.start),l=this.#e.root.querySelector(`[data-progress="${r}"]`);l&&a&&(l.value=a)}}),this.#e.root.querySelectorAll(".active")?.forEach(s=>{let{index:r}=s.dataset,a=this.#t.cues[r];if(a.subCues){let l=s.querySelector(".text");l.innerHTML=a.subCues.map(u=>`<span class="${u.status}">${u.text}</span>`).join("")}}),i===this.#n)return;this.#n=i;let e=this.#e.root.querySelectorAll("[data-progress]");if(e&&[...e].forEach(s=>{let r=s;r.value=0}),this.#i){let r=this.#e.root.querySelectorAll("[data-index]")[this.#n];r&&(d.isElementInViewport(r,"captionselement")||(this.#i=!1))}this.#L(),this.#I()}static isElementInViewport(t,i){let e=t.getBoundingClientRect(),r=t.closest(i).getBoundingClientRect();return e.bottom<=r.bottom}#$(t){if(!t)return"";let i=this.#u?this.#u.split("|"):[],e="<ol>";return t.cues?.forEach((s,r)=>{e+=this.#A(s,r,i)}),e+="</ol>",e}#A(t,i,e){if(!t.timecode)return"";let s=t.status||"",r=`<span class="timecode">${c.prettyTimecode(t.timecode.start)}</span>`,a=t.chapter?`<span class="chapter">${t.chapter}</span>`:"",l=this.#y?" ":"<br />",u="";t.type==="spacer"&&(u=`<progress max="${Math.round(t.seconds.end-t.seconds.start)}" value="0" data-progress="${i}"></progress>`);let o=`<span class="text">${t.text.join(l)}</span>`;return t.subCues&&(o='<span class="text">',o+=t.subCues.map(h=>`<span class="${h.status}">${h.text}</span>`).join(""),o+="</span>"),`<li class="cueitem">
      <button
        type="button"
        tabindex="0"
        data-start="${t.seconds.start}"
        class="cue ${s} ${t.type||""}"
        data-index="${i}"
      >${!e.includes("timecode")&&t.type!=="spacer"?r:""} ${e.includes("chapters")?"":a} ${e.includes("text")?"":o} ${u}
      </button></li>`}#L(){this.#e.root.querySelectorAll(".cueitem").forEach((i,e)=>{let s=this.#t.cues[e];i.firstElementChild.classList.remove("upcoming","next","active","previous","passed"),i.firstElementChild.classList.add(s?.status)})}#S(){if(!this.#t||!("cues"in this.#t))return;this.#t.cues=this.#t.cues.map(e=>(e.seconds.end-this.#a<this.#s&&(e.active=!1,e.status="passed"),e.seconds.start-this.#a>this.#s&&(e.active=!1,e.status="upcoming"),e.seconds.start-this.#a<this.#s&&e.seconds.end-this.#a>this.#s&&(e.active=!0,e.status="active"),e));let t=this.#t.cues.filter(e=>e.status==="passed"),i=this.#t.cues.findIndex(e=>e.status==="upcoming");i>0&&(this.#t.cues[i].status="next"),t&&t.length>0&&(this.#t.cues[t.length-1].status="previous"),this.#t.cues=this.#t.cues.map(e=>(e.subCues&&e.subCues.map(s=>(s.status=s.seconds<this.#s?"sub_active":"sub_upcoming",s)),e))}#I(){if(!this.#n||this.#n<0||this.#i)return;let i=this.#e.root.querySelectorAll("li")[this.#n];if(!i)return;let e=i.offsetHeight,s=i.offsetTop;this.#e.root.scrollTop=s-e,this.#T=!0,setTimeout(()=>{this.#T=!1},1e3)}pause(){this.#m=!this.#m}setTheme(t=void 0){let i=c.getTheme(t||this.#d||"");this.#d=i,this.#e.root.dataset.theme=i}async updateCues(t){if(!t)return"";let i=this.#t.cues?this.#t.cues.length:0;if(t.cues.length<=i)return"";let e=await this.#w(t);this.#t.cues=e.cues,this.#S(),e.cues.splice(0,i);let s="";e.cues.forEach((a,l)=>{s+=this.#A(a,l+i,this.#u)});let r=this.#e.root.querySelector("ol");return r&&(r.innerHTML+=s),r||(this.#e.root.innerHTML=`<ol>${s}</ol>`),this.#v(this.#s),s}#c(t,i,e){this.dispatchEvent(new CustomEvent("all",{detail:{name:t,value:i,full:e}})),this.dispatchEvent(new CustomEvent(t,{detail:{value:i,full:e}}))}async#M(t){if(!this.#e.root.querySelector("#tempVid")){let e=document.createElement("track");e.mode="active",e.default=!0,e.src=t;let s=document.createElement("video");s.preload="auto",s.setAttribute("id","tempVid"),s.appendChild(e),this.#e.root.appendChild(s)}let i=this.#e.root.querySelector("#tempVid");return await d.trackReady(i),i.textTracks[0]}static trackReady(t){let i=0;return new Promise(e=>{let s=setInterval(()=>{i+=1,i>1e3&&(clearInterval(s),e()),Array.from(t.textTracks[0].cues).length&&(clearInterval(s),e())},2)})}#q(t){this.#t.cues.splice(1,1);let i;return i=t.map((e,s)=>(e.text.length>0&&s!==1&&e.text.shift(),e)),i=t.filter(e=>e.text.length!==0),i=t.filter(e=>e.text[0]&&e.text[0].length!==0),i}};window.customElements.define("captions-viewer",d);
