var c=class{static timecodeToSeconds(t){let s=t.split(":");s.lenght===1&&(s=t.split(","));let e=parseInt(s[0],10),i=parseInt(s[1],10),r=parseInt(s[2],10),n=t.split(".");return e*3600+i*60+r+n[1]/1e3}static isValidJSON(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}static isTimecode(t){return/^[0-9][0-9]/.test(t)}static prettyTimecode(t){let s=t.split(":");if(s.length===0)return[];s.length-1===2&&s[0]==="00"&&s.splice(0,1);let e=s[s.length-1];return e=e.replace(",","."),e=Math.round(e),e<10&&(e=`0${e}`),s[s.length-1]=e,s.join(":")}static secondsToTimecode(t){return t==null?"":t<0?"00:00:00":new Date(t*1e3).toISOString().substring(11,11+8)}static getTheme(t){return t==="light"?"light":t==="dark"?"dark":matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}static getFileType(t){let s=t.split("."),e=s[s.length-1];return["vtt","srt"].find(r=>r===e)}};function T(o,t){let s=/<(\d\d:\d\d:\d\d\.\d\d\d)>/,e=o.split(s),i=[];for(let r=1;r<e.length;r+=1)r===1&&i.push({seconds:t,text:e[0],status:void 0}),i.push({seconds:c.timecodeToSeconds(e[r]),text:e[r+1],status:void 0}),r+=1;return i}function m(o,t=0){if(!o.cues)return;let s=Object.entries(o.cues).map(i=>{let r=i[1];return{chapter:r.id,status:"",text:r.text.split(`
`).map(n=>n.replace(/^\s+/g,"")),subCues:void 0,seconds:{start:r.startTime-t,end:r.endTime},timecode:{start:c.secondsToTimecode(r.startTime),end:c.secondsToTimecode(r.endTime)}}});return{kind:o.kind,lang:o.language,label:o.label,header:o.id,styles:void 0,cues:s}}function b(o){return o.map(t=>{let s=t.text[1]||"";return t.subCues=void 0,s.includes("<")&&(t.subCues=T(s,t.seconds.start)),t})}function y(o,t){let s=!1;return o.forEach((e,i)=>{let r=o[i+1];if(s){s=!1;return}if(!r)return;if(r.seconds.start-e.seconds.end>t){let h=e.seconds.end,d=r.seconds.start,a={chapter:"",text:[],type:"spacer",timecode:{start:c.secondsToTimecode(h),end:c.secondsToTimecode(h)},seconds:{start:h,end:d}};o.splice(i+1,0,a),s=!0}}),o}function v(o,t){let s=o.split(`
`),e={kind:t||s[0].startsWith("WEBVTT"),lang:void 0,header:void 0,styles:void 0,cues:[]},i={text:[]},r=0,n=!1,h="",d="";for(let a of s){if(a.startsWith("WEBVTT")){let l=a.split(" - ");l.length>0&&(e.header=l[1])}else if(a.startsWith("Kind")){let l=a.split(":");e.kind=l[1]?.trim()}else if(a.startsWith("Language")){let l=a.split(":");e.lang=l[1]?.trim()}else if(a.startsWith("STYLE"))n=!0,d="styles";else if(!a.startsWith("NOTE"))if(n===!0&&a!=="")h+=a;else if(n===!0&&a==="")e.styles=h,n=!1,h="";else if(a!==""&&c.isTimecode(s[r+1]))i.chapter=a;else if(c.isTimecode(a)){let l=a.split("-->"),u=l[1]?l[1]?.split(" "):void 0,g=u?u[1]?.trim():"";i.timecode={start:l[0].trim(),end:g},i.seconds={start:c.timecodeToSeconds(l[0]),end:c.timecodeToSeconds(g)},i.length=i.seconds.start+i.seconds.end;let f=a.split(" ");f.length>2&&(i.styles=f.splice(3).join(" "))}else a!==""&&i.text.push(a);a===""&&i.timecode?.start!==void 0&&(n&&(n=!1,d=""),i.active=!1,e.cues.push(i),i={text:[]}),r+=1}return e}function x(){return`<style>

  #root {
    display: block;
    scroll-behavior: smooth;
    height: 300px;
    overflow-y: scroll;
    overflow-x: hidden;
    scroll-snap-stop: always;
    position: relative;
    padding: .5rem;
    --base: 360;
    
    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 20%, 40%, 0.9);
    --active-primary: hsla(var(--base), 0%, 30%, 1);
    --active-secondary: hsla(var(--base), 20%, 80%, 1);
    --highlight: hsla(var(--base), 50%, 50%, 0.9);
  }
  #root * {
    box-sizing: border-box;
  }
  
  [data-theme="dark"]#root {
    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 10%, 80%, 0.7); 
    --active-primary: hsla(var(--base), 0%, 100%, 1);
    --active-secondary: hsla(var(--base), 20%, 80%, 1);
    --highlight: hsla(var(--base), 50%, 60%, 0.9);
  }
  
  .empty {
    color: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-70-opacity));
  }
  ol {
    padding: 0;
    margin: 0;
  }
  li {
    list-style:none;
    width: 100%;
  }
  .cue {
    border: none;
    font: inherit;
    padding: 0.3rem 1.5rem 0.3rem .4rem;
    display: flex;
    gap: 1rem;
    transform: scale(1);
    transform-origin: left;
    color: var(--inactive);
    transition: all .3s ease;
    background: none;
    width: 100%;
    text-align: start;
    border-left: 2px solid hsla(var(--base), 60%, 70%, 0.1);
    border-radius: 0;
  }
  @media(hover: hover) and (pointer: fine) {
    .cue:hover, .cue:active, .cue:focus {
      cursor: pointer;
      color: var(--active-secondary);
      background: none;
      border-left-color: var(--highlight);
      outline: 1px solid var(--highlight);
    }
  }
  .cue:focus-visible {
    cursor: pointer;
    border-left-color: var(--highlight);
    outline: 1px solid var(--highlight);
    color: var(--highlight);
    background: none;
  }    
  .upcoming {
    transform: scale(1);
    transform-origin: left;
  }
  .next {
    transform: scale(1);
    transform-origin: left;
  }
  .active {
    transform: scale(1.05);
    transform-origin: left;
    padding-right: 10%;
    border-color: var(--highlight);
    font-weight: bold;
  }
  .active .timecode {
    color: var(--active-secondary); 
  }
  .active .chapter {
    color: var(--active-secondary);  
  }
  .active .text  {
    color: var(--active-primary);
  }
  .passed  {
    transform: scale(1);
    transform-origin: left;
  }
  
  @media (prefers-reduced-motion) {
    .active, .previous {
      font-size: unset;
    }
  }
  
  progress {
    appearance: none;
    background: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-10-opacity));
    border: none;
    border-radius: 2px;
    height: 8px;
    align-self: center;
  }
  
  progress[value]::-webkit-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-20-opacity));
    box-shadow: none;
  }
  
  progress[value]::-moz-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-20-opacity));
    box-shadow: none;
  }
  progress[value]::-webkit-progress-value {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-20-opacity));
    box-shadow: none;
  }
  
  .active .sub_active {
    text-decoration: underline;
  }
  
  </style>`}var p=class extends HTMLElement{#y=!1;#t;#s="";#i=0;#c="400px";#o=0;#f=!1;#m="";#l="";#h="";#d=!1;#e={};#n=void 0;#a=!1;#u=!1;#r={};#b=5;#k=.5;css=x();constructor(){super(),this.isConnected&&this.#v()}static get observedAttributes(){return["src","playhead","height","debounce","singleline","color","disable","spacer"]}attributeChangedCallback(t,s,e){if(t==="playhead"){this.#x(e);return}if(t==="debounce"){this.#o=e;return}this.#p({changes:{name:t,oldValue:s,newValue:e}})}set src(t){this.setAttribute("src",t)}set playhead(t){this.setAttribute("playhead",t)}set debounce(t){this.setAttribute("debounce",t)}set singleline(t){if(typeof t!="boolean"){console.warn("singleline must be a boolean.",t),this.#g("error","singleline must be a boolean.");return}this.setAttribute("singleline",t)}set disable(t){this.setAttribute("disable",t)}set debounceScrolling(t){if(typeof t!="boolean"){console.warn("debounceScrolling must be a boolean.",t),this.#g("error","debounceScrolling must be a boolean.");return}this.#a=t}set textTrack(t){this.#r=t,this.#p()}set spacer(t){this.#b=t}set youtube(t){if(typeof t!="boolean"){console.warn("youtube must be a boolean.",t),this.#g("error","youtube must be a boolean.");return}this.#d=t}get src(){return this.#s}get playhead(){return this.#i}get captions(){return this.#e}get debounce(){return this.#o}get singleline(){return this.#f}get height(){return this.#c}get paused(){return this.#u}get disable(){return this.#l}get theme(){return this.#h}get spacer(){return this.#b}get textTrack(){return this.#r}get youtube(){return this.#d}connectedCallback(){this.#v()}#v(){if(this.#y){this.#p();return}this.#y=!0;let t=document.createElement("template");t.innerHTML=`
      ${this.css}
      <captionselement id="root" data-theme=""></captionselement>
    `;let s=t.content.cloneNode(!0);this.appendChild(s),this.#t={root:this.querySelector("#root")},this.#t.root.addEventListener("click",e=>{let i=e.composedPath()[0].closest("button");if(i&&"localName"in i&&i.localName==="button"){let{index:r}=i.dataset,n=this.#e.cues[r].seconds.start;this.#g("seek",n),this.#x(n+.2)}}),this.#t.root.addEventListener("scroll",()=>{this.#a=!0,console.log("[scroll] touch move..."),this.#t.root.addEventListener("mouseup",()=>{setTimeout(()=>{this.#a=!1},this.#o)}),setTimeout(()=>{this.#a=!1},this.#o*3)},!1),this.#p()}async#p(t){if(this.#s=this.getAttribute("src")||"",this.#i=parseInt(this.getAttribute("playhead"),10)||0,this.#c=this.getAttribute("height")||"400px",this.#o=parseInt(this.getAttribute("debounce"),10)||5e3,this.#f=this.getAttribute("singleline")==="true"||this.getAttribute("singleline")===!0||!1,this.#m=this.getAttribute("color")||"",this.#l=this.getAttribute("disable")||"",this.#h=this.getAttribute("theme")||"",this.#d=this.getAttribute("youtube")==="true"||this.getAttribute("youtube")===!0||!1,!this.#s&&!(this.#r&&"id"in this.#r)){console.debug("No text track");return}this.setTheme();let s=[];this.#c!=="400px"&&s.push(`height: ${this.#c}`),this.#m&&s.push(`--base: ${this.#m}`),this.#t.root?.setAttribute("style",s.join("; ")),t?.changes.name==="src"&&(this.#e=await this.#C()),this.#S()}async#C(){let t;if(this.#s&&c.getFileType(this.#s)==="vtt"&&(this.#r=await this.#E(this.#s)),this.#r&&"cues"in this.#r&&(console.log("Trying foo parser."),t=m(this.#r,this.#k)),this.#s&&(!t||!t.cues)){console.log("Trying backup parser.");let s=await fetch(this.#s).then(i=>i.text()),e=c.getFileType(this.#s);s&&(t=v(s,e))}if(!t||!t.cues){console.error("Not able to find and render captions.",t),this.#t.root.innerHTML='<p class="empty">No captions.</p>';return}return t.cues=b(t.cues),this.#d&&(t.cues=this.#$(t.cues)),t.cues=y(t.cues,this.#b),this.#T(),console.log("Final Captions.",t),t}#x(t){if(this.#u)return;this.#i=t,this.#T();let s=this.#e.cues?.findIndex(i=>i.status==="active");if(this.#e.cues?.forEach((i,r)=>{if(i.type==="spacer"&&i.status==="active"){let n=Math.round(this.#i-i.seconds.start),h=this.#t.root.querySelector(`[data-progress="${r}"]`);h&&(h.value=n)}}),this.#t.root.querySelectorAll(".active")?.forEach(i=>{let{index:r}=i.dataset,n=this.#e.cues[r];if(n.subCues){let h=i.querySelector(".text");h.innerHTML=n.subCues.map(d=>`<span class="${d.status}">${d.text}</span>`).join("")}}),s===this.#n)return;this.#n=s;let e=this.#t.root.querySelectorAll("[data-progress]");if(e&&[...e].forEach(i=>{let r=i;r.value=0}),this.#a){let r=this.#t.root.querySelectorAll("[data-index]")[this.#n];r&&(p.isElementInViewport(r,"captionselement")||(this.#a=!1))}this.#w(),this.#A()}static isElementInViewport(t,s){let e=t.getBoundingClientRect(),r=t.closest(s).getBoundingClientRect();return e.bottom<=r.bottom}#S(){if(!this.#e)return;let t=this.#l?this.#l.split("|"):[];this.#t.root.innerHTML="";let s="<ol>";this.#e.cues?.forEach((e,i)=>{if(e.timecode){let r=e.status,n=`<span class="timecode">${c.prettyTimecode(e.timecode.start)}</span>`,h=e.chapter?`<span class="chapter">${e.chapter}</span>`:"",d=this.#f?" ":"<br />",a="";e.type==="spacer"&&(a=`<progress max="${Math.round(e.seconds.end-e.seconds.start)}" value="0" data-progress="${i}"></progress>`);let l=`<span class="text">${e.text.join(d)}</span>`;e.subCues&&(l='<span class="text">',l+=e.subCues.map(u=>`<span class="${u.status}">${u.text}</span>`).join(""),l+="</span>"),s+=`<li tabindex="0">
          <button
            type="button"
            tabindex="${i+1}"
            class="cue ${r} ${e.type||""}"
            data-index="${i}"
          >${!t.includes("timecode")&&e.type!=="spacer"?n:""} ${t.includes("chapters")?"":h} ${t.includes("text")?"":l} ${a}
          </button></li>`}}),s+="</ol>",this.#t.root.innerHTML=s}#w(){this.#t.root.querySelectorAll("[data-index]").forEach(s=>{let{index:e}=s.dataset,i=this.#e.cues[e];s.classList.remove("upcoming","next","active","previous","passed"),s.classList.add(i.status)})}#T(){if(!("cues"in this.#e))return;this.#e.cues=this.#e.cues.map(e=>(e.seconds.end<this.#i&&(e.active=!1,e.status="passed"),e.seconds.start>this.#i&&(e.active=!1,e.status="upcoming"),e.seconds.start<this.#i&&e.seconds.end>this.#i&&(e.active=!0,e.status="active"),e));let t=this.#e.cues.filter(e=>e.status==="passed"),s=this.#e.cues.findIndex(e=>e.status==="upcoming");s>0&&(this.#e.cues[s].status="next"),t&&t.length>0&&(this.#e.cues[t.length-1].status="previous"),this.#e.cues=this.#e.cues.map(e=>(e.subCues&&e.subCues.map(i=>(i.status=i.seconds<this.#i?"sub_active":"sub_upcoming",i)),e))}#A(){if(!this.#n||this.#n<0||this.#a)return;let s=this.#t.root.querySelectorAll("li")[this.#n],e=s.offsetHeight,i=s.offsetTop;this.#t.root.scrollTop=i-e}pause(){this.#u=!this.#u}setTheme(t=void 0){let s=c.getTheme(t||this.#h||"");this.#h=s,this.#t.root.dataset.theme=s}#g(t,s,e){this.dispatchEvent(new CustomEvent("all",{detail:{name:t,value:s,full:e}})),this.dispatchEvent(new CustomEvent(t,{detail:{value:s,full:e}}))}async#E(t){if(!this.#t.root.querySelector("#tempVid")){let e=document.createElement("track");e.mode="active",e.default=!0,e.src=t;let i=document.createElement("video");i.preload="auto",i.setAttribute("id","tempVid"),i.appendChild(e),this.#t.root.appendChild(i)}let s=this.#t.root.querySelector("#tempVid");return await p.trackReady(s),s.textTracks[0]}static trackReady(t){let s=0;return new Promise(e=>{let i=setInterval(()=>{s+=1,s>1e3&&(clearInterval(i),e()),Array.from(t.textTracks[0].cues).length&&(clearInterval(i),e())},2)})}#$(t){this.#e.cues.splice(1,1);let s;return s=t.map((e,i)=>(e.text.length>0&&i!==1&&e.text.shift(),e)),s=t.filter(e=>e.text.length!==0),s=t.filter(e=>e.text[0]&&e.text[0].length!==0),s}};window.customElements.define("captions-viewer",p);
