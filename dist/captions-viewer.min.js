function p(i=""){if(!/^[0-9][0-9]/.test(i)||typeof i!="string")return;let s=i.split(":");if(!s||s.length===1)return i;let e=parseInt(s[0],10),r=parseInt(s[1],10),n=parseInt(s[2],10),o=i.split(".");return o.length===1&&(o=i.split(",")),e*3600+r*60+n+o[1]/1e3}function b(i){return/^[0-9][0-9]/.test(i)}function S(i){if(!/^[0-9][0-9]/.test(i)||typeof i!="string")return;let s=i.split(":");if(s.length===0)return[];s.length-1===2&&s[0]==="00"&&s.splice(0,1);let e=s[s.length-1];return e=e.replace(",","."),e=Math.round(e),e<10&&(e=`0${e}`),s[s.length-1]=e,s.join(":")}function u(i=0){return typeof i!="number"?"":i<0?"00:00:00":new Date(i*1e3).toISOString().substring(11,19)}function y(i){let t=i.split("."),s=t[t.length-1];return["vtt","srt"].find(r=>r===s)}function k(i,t){let s=i.getBoundingClientRect(),r=i.closest(t).getBoundingClientRect();return s.bottom<=r.bottom}function w(i){if(!i.cues)return;let t=Object.entries(i.cues).map(e=>{let r=e[1];return{chapter:r.id,status:"",text:r.text.split(`
`).map(n=>n.replace(/^\s+/g,"")),subCues:void 0,seconds:{start:r.startTime,end:r.endTime},timecode:{start:u(r.startTime),end:u(r.endTime)}}});return{kind:i.kind,lang:i.language,label:i.label,header:i.id,styles:void 0,cues:t}}function C(i,t){let s=i.split(`
`),e={kind:t||s[0].startsWith("WEBVTT"),lang:void 0,header:void 0,styles:void 0,cues:[]},r={text:[]},n=0,o=!1,c="",h="";for(let a of s){if(a.startsWith("WEBVTT")){let l=a.split(" - ");l.length>0&&(e.header=l[1])}else if(a.startsWith("Kind")){let l=a.split(":");e.kind=l[1]?.trim()}else if(a.startsWith("Language")){let l=a.split(":");e.lang=l[1]?.trim()}else if(a.startsWith("STYLE"))o=!0,h="styles";else if(!a.startsWith("NOTE"))if(o===!0&&a!=="")c+=a;else if(o===!0&&a==="")e.styles=c,o=!1,c="";else if(a!==""&&b(s[n+1]))r.chapter=a;else if(b(a)){let l=a.split("-->"),d=l[1]?l[1]?.split(" "):void 0,x=d?d[1]?.trim():"";r.timecode={start:l[0].trim(),end:x},r.seconds={start:p(l[0]),end:p(x)},r.length=r.seconds.start+r.seconds.end;let T=a.split(" ");T.length>2&&(r.styles=T.splice(3).join(" "))}else a!==""&&(t==="srt"?r.text.push(a.replace(/(<([^>]+)>)/gi,"")):r.text.push(a));a===""&&r.timecode?.start!==void 0&&(o&&(o=!1,h=""),r.active=!1,e.cues.push(r),r={text:[]}),n+=1}return e}var f=class{#r;constructor(t){this.#r=t}get cues(){return this.#r}set cues(t){this.#r=t}#t(t,s){let e=/<(\d\d:\d\d:\d\d\.\d\d\d)>/,r=t.split(e),n=[];for(let o=1;o<r.length;o+=1)o===1&&n.push({seconds:s,text:r[0],status:void 0}),n.push({seconds:p(r[o]),text:r[o+1],status:void 0}),o+=1;return n}parseSubTextCues(){let t=this.#r;return this.#r=t.map(s=>{let e=s.text[1]||"";return s.subCues=void 0,e.includes("<")&&(s.subCues=this.#t(e,s.seconds.start)),s}),this}addCueSpaces(t){let s=this.#r;if(!s||s.length===0)return;let e=!1,r=s[0];if(r.seconds.start>t){let n={chapter:"",text:[],type:"spacer",timecode:{start:u(0),end:u(r.seconds.start)},seconds:{start:0,end:r.seconds.start}};s.unshift(n)}return s.forEach((n,o)=>{let c=s[o+1];if(e){e=!1;return}if(!c)return;if(c.seconds.start-n.seconds.end>t){let a=n.seconds.end,l=c.seconds.start,d={chapter:"",text:[],type:"spacer",timecode:{start:u(a),end:u(a)},seconds:{start:a,end:l}};s.splice(o+1,0,d),e=!0}return[]}),this.#r=s,this}sortCues(){let t=this.#r;return t&&(this.#r=t.sort((s,e)=>s.seconds.start<e.seconds.start?-1:s.seconds.start>e.seconds.start?1:0),this)}removeDuplicateCues(){let t=this.#r,s=t.map(e=>JSON.stringify(e));return this.#r=t.filter((e,r)=>{let n=t.findIndex((o,c)=>s[c]===s[r]);return r===n}),this}};function E(i){return i==="light"?"light":i==="dark"?"dark":matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}var g=class{#r=[];constructor(t){let s=[];t?.height!=="400px"&&s.push(`height: ${t?.height}`),t?.color&&s.push(`--base: ${t?.color}`),this.#r.push(s)}get toCss(){return this.#r.join("; ")}};function v(i,t,s,e){if(!i.timecode)return"";let r=i.status||"",n=`<span class="timecode">${S(i.timecode.start)}</span>`,o=i.chapter?`<span class="chapter">${i.chapter}</span>`:"",c=e?" ":"<br />",h="";i.type==="spacer"&&(h=`<progress max="${Math.round(i.seconds.end-i.seconds.start)}" value="0" data-progress="${t}"></progress>`);let a=`<span class="text">${i.text.join(c)}</span>`;return i.subCues&&(a='<span class="text">',a+=i.subCues.map(l=>`<span class="${l.status}">${l.text}</span>`).join(""),a+="</span>"),`<li class="cueitem">
    <button
      type="button"
      tabindex="0"
      data-start="${i.seconds.start}"
      class="cue ${r} ${i.type||""}"
      data-index="${t}"
      style="animation-duration: ${Math.round(i.seconds.end-i.seconds.start)}s"
    >${!s.includes("timecode")&&i.type!=="spacer"?n:""} ${s.includes("chapters")?"":o} ${s.includes("text")?"":a} ${h}
    </button></li>`}function A(i,t,s){if(!i)return"";let e=t?t.split("|"):[],r="<ol>";return i.cues?.forEach((n,o)=>{r+=v(n,o,e,s)}),r+="</ol>",r}function L(i,t){i.root.querySelectorAll(".cueitem").forEach((e,r)=>{let n=t.cues[r];e.firstElementChild.classList.remove("upcoming","next","active","previous","passed"),e.firstElementChild.classList.add(n?.status)})}function $(){return`<style id="theme_a">
  #root {
    display: block;
    scroll-behavior: smooth;
    height: 300px;
    overflow-y: scroll;
    overflow-x: hidden;
    scroll-snap-stop: always;
    position: relative;
    padding: .5rem;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    --base: 360;

    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-50-opacity: 0.5;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 20%, 40%, 0.9);
    --inactive-90: hsla(var(--base), 20%, 40%, 0.5);
    --active-primary: hsla(var(--base), 0%, 30%, 1);
    --active-secondary: hsla(var(--base), 40%, 70%, 1);
    --highlight: hsla(var(--base), 50%, 50%, 0.9);
  }
  [data-theme="dark"]#root {
    --gray-10-sat: 10%;
    --gray-10-light: 10%;
    --gray-10-opacity: 0.1;
    --gray-20-sat: 10%;
    --gray-20-light: 10%;
    --gray-20-opacity: 0.2;
    --gray-70-opacity: 0.7;
    --inactive: hsla(var(--base), 10%, 80%, 0.7);
    --inactive-90: hsla(var(--base), 10%, 80%, 0.5);
    --active-primary: hsla(var(--base), 0%, 100%, 1);
    --active-secondary: hsla(var(--base), 20%, 80%, 1);
    --highlight: hsla(var(--base), 50%, 60%, 0.9);
  }
  #root * {
    box-sizing: border-box;
  }
  .empty {
    color: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-70-opacity));
  }
  ol {
    padding: 0;
    margin: 0;
  }
  li {
    list-style:none;
    width: 100%;
  }
  .cue {
    border: none;
    font: inherit;
    padding: 0.4rem 10% 0.4rem .4rem;
    display: flex;
    gap: 1rem;
    transform: scale(1);
    transform-origin: left;
    color: var(--inactive);
    transition: all .3s ease;
    background: none;
    width: 100%;
    text-align: start;
    border-left: 2px solid hsla(var(--base), 60%, 70%, 0.1);
    border-radius: 0;
    color: transparent;
    text-shadow: 0 0 2px var(--inactive-90);
    font-weight: bold;
  }
  .cue:focus {
    background: none;
    border: none;
    outline: none;
  }
  .cue:hover, .cue:active {
    cursor: pointer;
    color: var(--active-secondary);
    background: none;
    border-left-color: var(--highlight);
    outline: 1px solid var(--highlight);
    text-shadow: none;
  }
  @supports (-webkit-touch-callout: none) {
    .cue:hover {
      outline: none;
    }
  }
  .cue:focus-visible, .cue:focus {
    cursor: pointer;
    border-left-color: var(--highlight);
    outline: 1px solid var(--highlight);
    color: var(--secondary);
    background: none;
    text-shadow: none;
  }
  .cue:hover {
    background :none;
  }
  .upcoming {
    transform: scale(1);
    transform-origin: left;
  }
  .next {
    transform: scale(1);
    transform-origin: left;
    text-shadow: none;
    color: var(--inactive);
  }
  .active {
    transform: scale(1.05);
    transform-origin: left;
    border-color: var(--highlight);
    text-shadow: none;
    font-weight: bold;
    color: var(--active-secondary);
  }
  .active .timecode {
    color: var(--active-secondary);
  }
  .active .chapter {
    color: var(--active-secondary);
  }
  .active .text  {
    color: var(--active-primary);
  }
  .active .sub_active {
    text-decoration: underline;
  }
  .previous {
    color: var(--inactive);
  }
  .passed  {
    transform: scale(1);
    transform-origin: left;
  }
  .scrolling .cue {
    text-shadow: none;
    color: var(--inactive);
  }
  @media (prefers-reduced-motion) {
    .active {
      transform: scale(1);
    }
  }
  progress {
    appearance: none;
    background: hsla(var(--base), var(--gray-10-sat), var(--gray-10-light), var(--gray-10-opacity));
    border: none;
    border-radius: 2px;
    height: 8px;
    align-self: center;
  }
  progress[value]::-webkit-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-20-opacity));
    box-shadow: none;
  }
  progress[value]::-moz-progress-bar {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-50-opacity));
    box-shadow: none;
  }
  progress[value]::-webkit-progress-value {
    background: hsla(var(--base), var(--gray-20-sat), var(--gray-20-light), var(--gray-50-opacity));
    box-shadow: none;
  }

  .hidden {
    display: none;
  }
  captions-viewer-empty {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    color: rgba(100,100,100, .9)
  }
  </style>`}var m=class i extends HTMLElement{#r=!1;#t;#a="";#g;#i=0;#m="400px";#c=4e3;#b=!1;#T="";#y="";#p="";#f=!1;#l=!0;#e={};#o=void 0;#n=!1;#v=!1;#h={};#S=5;#u=.5;#k=!1;css=$();constructor(){super(),this.isConnected&&this.#C()}static get observedAttributes(){return["src","playhead","height","debounce","singleline","color","disable","spacer","enableCSS"]}attributeChangedCallback(t,s,e){if(t==="playhead"){this.#d(e);return}if(t==="debounce"){this.#c=e;return}this.#x({changes:{name:t,oldValue:s,newValue:e}})}get captions(){return this.#e}get debounce(){return this.#c}set debounce(t){if(typeof t!="number"){this.#s("error","debounce must be a number.");return}t?this.setAttribute("debounce",t):this.removeAttribute("debounce")}get debounceScrolling(){return this.#n}set debounceScrolling(t){if(typeof t!="boolean"){this.#s("error","debounceScrolling must be a boolean.");return}this.#n=t}get disable(){return this.#y}set disable(t){if(typeof t!="string"){this.#s("error","Disable must be a string.");return}this.setAttribute("disable",t),t?this.setAttribute("disable",t):this.removeAttribute("disabled")}get enableCSS(){return this.#l}set enableCSS(t){if(typeof t!="boolean"){this.#s("error","enableCSS must be a boolean.");return}this.#l=t}get height(){return this.#m}set height(t){if(typeof t!="string"){this.#s("error","height must be a string with a unit value.");return}this.setAttribute("height",t)}get nudge(){return this.#u}set nudge(t){if(typeof t!="number"){this.#s("error","nudge must be a number");return}this.#u=t}get paused(){return this.#v}set paused(t){this.passed(t)}get singleline(){return this.#b}set singleline(t){if(typeof t!="boolean"){this.#s("error","singleline must be a boolean.");return}this.setAttribute("singleline",t)}get playhead(){return this.#i}set playhead(t){if(typeof t!="number"){this.#s("error","playhead must be a number.");return}this.setAttribute("playhead",t)}get spacer(){return this.#S}set spacer(t){if(typeof t!="number"){this.#s("error","spacer must be a number.");return}this.#S=t}get src(){return this.#a}set src(t){if(typeof t!="string"){this.#s("error","src must be a string.");return}t?this.setAttribute("src",t):this.removeAttribute("src")}get textTrack(){return this.#h}set textTrack(t){this.#h=t,this.#x({changes:{name:"textTrack"}})}get theme(){return this.#p}set theme(t){this.setTheme(t)}get youtube(){return this.#f}set youtube(t){if(typeof t!="boolean"){this.#s("error","youtube must be a boolean.");return}this.#f=t}connectedCallback(){this.#C()}#C(){if(this.#r){this.#x();return}this.#r=!0;let t=document.createElement("template");t.innerHTML=`
      ${this.css}
      <captionselement id="root" data-theme=""></captionselement>
    `;let s=t.content.cloneNode(!0);this.appendChild(s),this.#t={root:this.querySelector("#root"),empty:this.querySelector("captions-viewer-empty")},this.#t.root.addEventListener("click",e=>{let r=e.composedPath()[0].closest("button");if(r&&"localName"in r&&r.localName==="button"){let n=r.dataset.start;this.#s("seek",n),this.#d(n+.2)}}),this.#M(),this.#x()}async#x(t){if(this.#a=this.getAttribute("src")||this.#a,this.#g=this.getAttribute("player")||this.#g,this.#i=parseInt(this.getAttribute("playhead"),10)||this.#i,this.#m=this.getAttribute("height")||this.#m,this.#c=parseInt(this.getAttribute("debounce"),10)||this.#c,this.#b=this.getAttribute("singleline")==="true"||this.getAttribute("singleline")===!0||!1,this.#T=this.getAttribute("color")||this.#T,this.#y=this.getAttribute("disable")||"",this.#p=this.getAttribute("theme")||this.#p,this.#f=this.getAttribute("youtube")==="true"||this.getAttribute("youtube")===!0||this.#f,this.#l=this.getAttribute("stylesheet")||this.#l,!this.#a&&!(this.#h&&"id"in this.#h)){this.#E();return}if(this.#l==="false"||this.#l===!1){let e=this.querySelector("#theme_a");e.innerHTML=""}this.setTheme();let s=new g({height:this.#m,color:this.#T});if(this.#t.root?.setAttribute("style",s.toCss),t?.changes.name==="src"||t?.changes.name==="textTrack"){if(this.#e=await this.#A(this.#h,this.#a),!this.#e||!this.#e.cues)return;this.#s("parsed","Caption file has been parsed.",this.#e),this.#f&&(this.#e.cues=this.#H(this.#e.cues)),this.#w(),this.#d(this.#i+.9)}this.#$(),this.#t.root.innerHTML=A(this.#e,this.#y,this.#b),this.#g&&this.#L()}#E(){if(this.#t.root?.classList.add("hidden"),!this.#t.empty){this.#t.root.innerHTML="";return}if(this.#t.empty?.innerHTML===""){this.#t.empty.innerHTML="No captions.";return}this.#t.empty.classList.remove("hidden")}async#A(t,s){let e,r=t;if(s&&y(s)==="vtt"&&(r=await this.#q(s)),r&&"cues"in r&&(e=w(r)),s&&(!e||!e.cues)){let n=await fetch(s).then(c=>c.text()),o=y(s);n&&(e=C(n,o))}return!e||!e.cues?(this.#E(),null):(e.cues=new f(e.cues).parseSubTextCues().removeDuplicateCues().addCueSpaces(this.#S).sortCues().cues,this.#h=r,e)}#w(){if(!this.#e||!("cues"in this.#e))return;this.#e.cues=this.#e.cues.map(e=>(e.seconds.end-this.#u<this.#i&&(e.active=!1,e.status="passed"),e.seconds.start-this.#u>this.#i&&(e.active=!1,e.status="upcoming"),e.seconds.start-this.#u<this.#i&&e.seconds.end-this.#u>this.#i&&(e.active=!0,e.status="active"),e));let t=this.#e.cues.filter(e=>e.status==="passed"),s=this.#e.cues.findIndex(e=>e.status==="upcoming");s>0&&(this.#e.cues[s].status="next"),t&&t.length>0&&(this.#e.cues[t.length-1].status="previous"),this.#e.cues=this.#e.cues.map(e=>(e.subCues&&e.subCues.map(r=>(r.status=r.seconds<this.#i?"sub_active":"sub_upcoming",r)),e))}#$(){this.#t.empty?.classList.add("hidden")}#M(){let t=!1,s,e=()=>{this.#t.root.classList.add("scrolling")},r=()=>{this.#t.root.classList.remove("scrolling")};this.#t.root.addEventListener("touchstart",()=>{t=!0,this.#n=!0,clearTimeout(s),e()},{passive:!0}),this.#t.root.addEventListener("touchend",()=>{t=!1,s=setTimeout(()=>{t=!1,this.#n=!1,r()},this.#c)}),setTimeout(()=>{this.#t.root.addEventListener("scroll",()=>{t||this.#k||(this.#n===!0&&clearTimeout(s),this.#n=!0,e(),s=setTimeout(()=>{this.#n=!1,r()},this.#c))},!1)},1e3)}#d(t){if(this.#v||(this.#i=t,!this.#e||!this.#e.cues))return;this.#w();let s=this.#e.cues?.findIndex(r=>r.status==="active");if(this.#e.cues?.forEach((r,n)=>{if(r.type==="spacer"&&r.status==="active"){let o=Math.round(this.#i-r.seconds.start),c=this.#t.root.querySelector(`[data-progress="${n}"]`);c&&o&&(c.value=o)}}),this.#t.root.querySelectorAll(".active")?.forEach(r=>{let{index:n}=r.dataset,o=this.#e.cues[n];if(o.subCues){let c=r.querySelector(".text");c.innerHTML=o.subCues.map(h=>`<span class="${h.status}">${h.text}</span>`).join("")}}),s===this.#o)return;this.#o=s,this.#s("cuechange",this.#e.cues[this.#o]);let e=this.#t.root.querySelectorAll("[data-progress]");if(e&&[...e].forEach(r=>{if(r.value===0)return;let n=r;n.value=0}),this.#n){let n=this.#t.root.querySelectorAll("[data-index]")[this.#o];n&&(k(n,"captionselement")||(this.#n=!1))}L(this.#t,this.#e),this.#I()}#I(){if(!this.#o||this.#o<0||this.#n)return;let s=this.#t.root.querySelectorAll("li")[this.#o];if(!s)return;let e=s.offsetHeight,r=s.offsetTop;this.#t.root.scrollTop=r-e,this.#k=!0,setTimeout(()=>{this.#k=!1},1e3)}#s(t,s,e){this.dispatchEvent(new CustomEvent("all",{detail:{name:t,value:s,full:e}})),this.dispatchEvent(new CustomEvent(t,{detail:{value:s,full:e}}))}async#q(t){if(!this.#t.root.querySelector("#tempVid")){let r=document.createElement("track");r.mode="active",r.default=!0,r.src=t;let n=document.createElement("video");n.preload="auto",n.setAttribute("id","tempVid"),n.appendChild(r),this.#t.root.appendChild(n)}let s=this.#t.root.querySelector("#tempVid"),e=await i.trackReady(s).catch(r=>{this.#s("error","No Tracks found.",r)});return await i.cuesReady(e).catch(r=>{this.#s("error","No cues found in track.",r)}),s.textTracks[0]}static trackReady(t,s){let e=0;return new Promise((r,n)=>{let o=setInterval(()=>{e+=1,e>1e3&&(clearInterval(o),n(new Error("No tracks found in time.")));let c=Array.from(t.textTracks);if(c.length>0){let h=s?c.find(a=>a.language===s):c.find(a=>a.kind==="captions"||a.kind==="subtitles");h&&(clearInterval(o),r(h))}},2)})}static cuesReady(t){let s=0;return new Promise((e,r)=>{let n=setInterval(()=>{s+=1,s>1e3&&(clearInterval(n),r(new Error("No cues found in time."))),t.cues&&t.cues.length>0&&(clearInterval(n),e(t.cues))},2)})}#H(t){this.#e.cues.splice(1,1);let s;return s=t.map((e,r)=>(e.text.length>0&&r!==1&&e.text.shift(),e)),s=t.filter(e=>e.text.length!==0),s=t.filter(e=>e.text[0]&&e.text[0].length!==0),s}async#N(t,s){let e=await i.trackReady(t,s).catch(()=>{});return e?(e.mode="hidden",await i.cuesReady(e),this.textTrack=e,e.addEventListener("cuechange",r=>{this.updateCues(r.target)}),e):new Error("No subtitle track found.",t.textTracks)}#B(t,s){let e=t||document.querySelector(`${s}`);if(!e)return;let r;return e.tagName!=="VIDEO"&&e.tagName!=="AUDIO"?r=e.querySelector("video")??e.querySelector("audio"):r=e,r}#L(t,s=0){let e=this.#B(t,this.#g);if(!e){this.#s("error","A video or audio player element can not be found for automatic setup.");return}s===0&&e.addEventListener("timeupdate",()=>{this.#i=e.currentTime,this.#d(this.#i)});let r=!1;if(e.addEventListener("play",()=>{r=!0}),s>0){let n;e.addEventListener("play",()=>{this.#i=e.currentTime,n=setInterval(()=>{this.#i=e.currentTime,this.#d(this.#i)})},s),e.addEventListener("pause",()=>{clearInterval(n)})}e.addEventListener("seeking",()=>{this.#n=!1}),this.addEventListener("seek",n=>{r||e.play(),e.currentTime=n.detail.value})}config(t){if(!t.player){this.#s("error","player is not defined.");return}let s=t.refresh||void 0,e=t.language||void 0,r=t.setPlayhead===void 0||t.setPlayhead===!1,n=t.setCaptions===void 0||t.setCaptions===!1,o=this.#a!=="";r&&this.#L(t.player,s),n&&!o&&this.#N(t.player,e)}async updateCues(t){if(!t)return"";let s=this.#e.cues?this.#e.cues.length:0;if(t.cues.length<=s)return"";let e=await this.#A(t);this.#e.cues=e.cues,this.#w(),e.cues.splice(0,s);let r="";e.cues.forEach((o,c)=>{r+=v(o,c+s,this.#y,this.#b)});let n=this.#t.root.querySelector("ol");return n&&(n.innerHTML+=r),n||(this.#t.root.innerHTML=`<ol>${r}</ol>`),this.#d(this.#i),r}pause(){this.#v=!this.#v}setTheme(t){let s=E(t||this.#p||"");return this.#p=s,this.#t.root.dataset.theme=s,s}};window.customElements.define("captions-viewer",m);
